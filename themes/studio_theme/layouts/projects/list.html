{{ define "main" }}
  <section class="mb-12 max-w-4xl">
    <div class="space-y-12">
      <h1 class="font-serif text-2xl text-green-900 sm:text-4xl md:text-6xl">{{ .Title }}</h1>
      {{ if .Content }}
        <div class="space-y-12 font-serif text-2xl leading-10 text-zinc-800">{{ .Content }}</div>
        {{ partial "terms.html" (dict "taxonomy" "tags" "page" .) }}
      {{ end }}
    </div>
  </section>

  <section class="mb-12">
    {{ $pages := .Pages }}
    {{ if .Params.sort_by_weight }}{{ $pages = .Pages.ByWeight }}{{ else }}{{ $pages = .Pages.ByDate.Reverse }}{{ end }}
    {{ $featuredPages := where $pages "Params.featured" true }}
    {{ $regularPages := where $pages "Params.featured" "!=" true }} {{ $finalPages := slice }} {{ $featuredIndex := 0 }}
    {{ $regularIndex := 0 }}
    {{ range $index := seq 0 (sub (add (len $featuredPages) (len $regularPages)) 1) }}
      {{ $groupOf6 := div $index 6 }} {{ $posInGroup := mod $index 6 }}
      {{ $isFeaturedPosition := or (eq $posInGroup 0) (eq $posInGroup 3) }}
      {{ if $isFeaturedPosition }}
        {{ if lt $featuredIndex (len $featuredPages) }}
          {{ $finalPages = $finalPages | append (index $featuredPages $featuredIndex) }}
          {{ $featuredIndex = add $featuredIndex 1 }}
        {{ else }}
          {{ if lt $regularIndex (len $regularPages) }}
            {{ $finalPages = $finalPages | append (index $regularPages $regularIndex) }}
            {{ $regularIndex = add $regularIndex 1 }}
          {{ end }}

        {{ end }}

      {{ else }}
        {{ if lt $regularIndex (len $regularPages) }}
          {{ $finalPages = $finalPages | append (index $regularPages $regularIndex) }}
          {{ $regularIndex = add $regularIndex 1 }}
        {{ else }}
          {{ if lt $featuredIndex (len $featuredPages) }}
            {{ $finalPages = $finalPages | append (index $featuredPages $featuredIndex) }}
            {{ $featuredIndex = add $featuredIndex 1 }}
          {{ end }}

        {{ end }}

      {{ end }}

    {{ end }}


    <div class="grid auto-rows-max grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
      {{ range $index, $page := $finalPages }}
        {{ $posInGroup := mod $index 6 }}
        {{ $isFeatured := or (eq $posInGroup 0) (eq $posInGroup 3) }}
        <article class="group {{ if $isFeatured }}sm:col-span-2 sm:row-span-2{{ end }}">
          <a
            href="{{ $page.Permalink }}"
            class="{{ if $isFeatured }}
              h-112
            {{ end }} relative block overflow-hidden rounded-sm shadow-lg transition-all duration-300 hover:shadow-xl"
          >
            {{ if $page.Params.featured_image }}
              <img
                src="{{ $page.RelPermalink }}{{ $page.Params.featured_image }}"
                alt="{{ $page.Title }}"
                class="{{ if $isFeatured }}
                  h-112
                {{ else }}
                  h-56
                {{ end }} w-full object-cover transition-transform duration-300 group-hover:scale-105"
                loading="lazy"
              />
            {{ else }}
              <img
                src="/images/verbena.jpeg"
                alt="{{ $page.Title }}"
                class="{{ if $isFeatured }}
                  h-112
                {{ else }}
                  h-56
                {{ end }} w-full object-cover transition-transform duration-300 group-hover:scale-105"
                loading="lazy"
              />
            {{ end }}


            <!-- Always visible overlay for mobile, hover overlay for desktop -->
            <div
              class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent transition-opacity duration-300 sm:opacity-0 sm:group-hover:opacity-100"
            ></div>

            <!-- Title overlay - always visible on mobile, hover on desktop -->
            <div
              class="absolute right-0 bottom-0 left-0 p-4 transition-transform duration-300 sm:translate-y-2 sm:group-hover:translate-y-0"
            >
              <h2
                class="mb-1 font-serif text-xl font-semibold text-white transition-opacity delay-100 duration-300 sm:opacity-0 sm:group-hover:opacity-100 md:text-2xl"
              >
                {{ $page.Title }}
              </h2>
              {{ if $page.Params.location }}
                <p
                  class="text-sm text-white/80 transition-opacity delay-150 duration-300 sm:opacity-0 sm:group-hover:opacity-100"
                >
                  {{ $page.Params.location }}
                </p>
              {{ end }}
            </div>
          </a>
        </article>
      {{ end }}
    </div>
  </section>
{{ end }}
