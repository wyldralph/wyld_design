{{ define "main" }}
  <article>
    <!-- Hero Section -->
    <section class="relative mb-16 overflow-hidden rounded-sm">
      {{ if .Params.featured_image }}
        <div class="relative h-96 md:h-[500px]">
          <img src="{{ .Params.featured_image }}" alt="{{ .Title }}" class="h-full w-full object-cover" />
          <div class="absolute inset-0 bg-black/20"></div>
        </div>
      {{ else }}
        <div class="relative h-96 md:h-[500px]">
          <img src="/images/verbena.jpeg" alt="{{ .Title }}" class="h-full w-full object-cover" />
          <div class="absolute inset-0 bg-black/20"></div>
        </div>
      {{ end }}


      <!-- Hero Text Overlay -->
      <div class="absolute right-0 bottom-0 left-0 bg-gradient-to-t from-black/70 to-transparent p-8">
        <h1 class="font-serif text-3xl font-bold text-white md:text-5xl lg:text-6xl">{{ .Title }}</h1>
        {{ if .Params.location }}
          <p class="mt-2 font-serif text-lg text-white/90 md:text-2xl">{{ .Params.location }}</p>
        {{ end }}
      </div>
    </section>

    <!-- Main Content with Gallery -->
    {{ $rawContent := .RawContent }}
    <!-- prettier-ignore -->
    {{ if in $rawContent "{{< auto-gallery >}}" }}
      <!-- Content contains auto-gallery shortcode, split and render -->
      {{ $parts := split $rawContent "{{< auto-gallery >}}" }}
      {{ range $index, $part := $parts }}
        {{ if ne $part "" }}
          <section class="mb-12 max-w-4xl">
            <div class="project-content leading-relaxed font-serif text-xl space-y-8">{{ $part | markdownify }}</div>
          </section>
        {{ end }}
        {{ if lt $index (sub (len $parts) 1) }}
          <!-- Insert gallery between parts -->
          {{ partial "auto-gallery.html" $ }}
        {{ end }}
      {{ end }}
    {{ else }}
      <!-- No gallery, render content normally -->
      <section class="mb-12 max-w-4xl">
        <div class="project-content font-serif text-xl">{{ .Content }}</div>
      </section>
    {{ end }}
  </article>
{{ end }}
