{{ define "main" }}
  <article class="">
    <!-- Hero Section -->
    <section class="relative mb-16 overflow-hidden rounded-lg">
      {{ if .Params.featured_image }}
        <div class="relative h-96 md:h-[500px]">
          <img src="{{ .Params.featured_image }}" alt="{{ .Title }}" class="h-full w-full object-cover" />
          <div class="absolute inset-0 bg-black/20"></div>
        </div>
      {{ else }}
        <div class="relative h-96 md:h-[500px]">
          <img src="/images/verbena.jpeg" alt="{{ .Title }}" class="h-full w-full object-cover" />
          <div class="absolute inset-0 bg-black/20"></div>
        </div>
      {{ end }}


      <!-- Hero Text Overlay -->
      <div class="absolute right-0 bottom-0 left-0 bg-gradient-to-t from-black/70 to-transparent p-8">
        <h1 class="font-serif text-3xl font-bold text-white md:text-5xl lg:text-6xl">{{ .Title }}</h1>
        {{ if .Params.location }}
          <p class="mt-2 font-serif text-lg text-white/90 md:text-2xl">{{ .Params.location }}</p>
        {{ end }}
      </div>
    </section>

    <!-- Main Content with Gallery -->
    {{ $rawContent := .RawContent }}
    <!-- prettier-ignore -->
    {{ if in $rawContent "{{< auto-gallery >}}" }}
      <!-- Content contains auto-gallery shortcode, split and render -->
      {{ $parts := split $rawContent "{{< auto-gallery >}}" }}
      {{ range $index, $part := $parts }}
        {{ if ne $part "" }}
          <section class="mb-12 max-w-4xl">
            <div class="project-content font-serif text-xl space-y-12">{{ $part | markdownify }}</div>
          </section>
        {{ end }}
        {{ if lt $index (sub (len $parts) 1) }}
          <!-- Insert gallery between parts -->
          {{ partial "auto-gallery.html" $ }}
        {{ end }}
      {{ end }}
    {{ else }}
      <!-- No gallery, render content normally -->
      <section class="mb-12 max-w-4xl">
        <div class="project-content font-serif text-xl">{{ .Content }}</div>
      </section>
    {{ end }}

    <!-- Project Details Section -->
    <section class="mb-12 rounded-lg bg-green-50 py-12">
      <div class="grid gap-8 px-8 sm:grid-cols-12">
        <!-- Process Provided -->
        {{ if .Params.process_provided }}
          <div class="col-span-4">
            <h3 class="mb-4 font-serif text-xl text-green-900">Process Provided</h3>
            <ul class="space-y-2">
              {{ range .Params.process_provided }}
                <li class="flex items-center">
                  <span class="mr-3 h-2 w-2 rounded-full bg-green-900"></span>
                  {{ . }}
                </li>
              {{ end }}
            </ul>
          </div>
        {{ end }}


        <!-- Key Plants -->
        {{ if .Params.plants_featured }}
          <div class="col-span-4">
            <h3 class="mb-4 font-serif text-xl text-green-900">Featured Plants</h3>
            <ul class="space-y-2">
              {{ range .Params.plants_featured }}
                <li class="flex items-center">
                  <span class="mr-3 h-2 w-2 rounded-full bg-green-900"></span>
                  <em>{{ . }}</em>
                </li>
              {{ end }}
            </ul>
          </div>
        {{ end }}


        <!-- Materials -->
        {{ if .Params.materials }}
          <div class="col-span-4">
            <h3 class="mb-4 font-serif text-xl text-green-900">Key Materials</h3>
            <ul class="space-y-2">
              {{ range .Params.materials }}
                <li class="flex items-center">
                  <span class="mr-3 h-2 w-2 rounded-full bg-green-900"></span>
                  {{ . }}
                </li>
              {{ end }}
            </ul>
          </div>
        {{ end }}
      </div>
    </section>

    <!-- Tags -->
    {{ if .Params.tags }}
      <section class="mb-12">
        <div class="flex flex-wrap gap-2">
          {{ range .Params.tags }}
            <span class="inline-block rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800"
              >{{ . }}</span
            >
          {{ end }}
        </div>
      </section>
    {{ end }}
  </article>
{{ end }}
